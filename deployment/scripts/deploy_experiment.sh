#!/bin/bash

QUERY=$1                      #{1, 2, 3, 5, 8, 11}
MODE=$2                       #{reactive, non-reactive}
INITIAL_PARALLELISM=$3
AVAILABLE_TASKMANAGERS=$4
AUTOSCALER=$5
INPUT_RATE_MEAN=$6           # Mean of Cosinus pattern
INPUT_RATE_MAX_DIVERGENCE=$7
NAMESPACE=$8

AUTOSCALER_DEPLOYMENT_COOLDOWN="2m"
echo "Deploying experiment with: Query=$QUERY MODE=$MODE INITIAL_PARALLELISM=$INITIAL_PARALLELISM AVAILABLE_TASKMANAGERS=$AVAILABLE_TASKMANAGERS AUTOSCALER=$AUTOSCALER INPUT_RATE_MEAN=$INPUT_RATE_MEAN INPUT_RATE_MAX_DIVERGENCE=$INPUT_RATE_MAX_DIVERGENCE NAMESPACE=$NAMESPACE"
source ./deploy_nfs.sh $NAMESPACE
source ./deploy_queries.sh $QUERY $MODE $INITIAL_PARALLELISM $INPUT_RATE_MEAN $INPUT_RATE_MAX_DIVERGENCE

echo "Sleeping for $AUTOSCALER_DEPLOYMENT_COOLDOWN before deploying autoscaler."
sleep $AUTOSCALER_DEPLOYMENT_COOLDOWN

source ./deploy_autoscaler.sh $AUTOSCALER $QUERY $MODE $AVAILABLE_TASKMANAGERS $NAMESPACE
echo "Finished deployment"
